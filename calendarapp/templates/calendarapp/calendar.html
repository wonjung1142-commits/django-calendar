<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ï†úÏùºÏïΩÍµ≠ Ï∫òÎ¶∞Îçî</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <style>
    body { background-color: #ffffff; font-family: 'Pretendard', -apple-system, sans-serif; overflow: hidden; touch-action: none; }
    .header-bar { background: white; border-bottom: 1px solid #f1f3f4; display: flex; align-items: center; padding: 10px 15px; height: 60px; }
    .btn-home { background-color: #f1f3f4; color: #3c4043; border: none; border-radius: 30px; padding: 6px 14px; font-weight: 700; font-size: 0.9rem; text-decoration: none; display: flex; align-items: center; }
    .btn-home span { margin-left: 5px; }
    #calendar-container { padding: 5px; }
    #calendar { height: calc(100vh - 70px); }
    a { text-decoration: none !important; color: #202124 !important; }
    .fc-col-header-cell.fc-day-sun a, .fc-daygrid-day.fc-day-sun .fc-daygrid-day-number, .holiday-red .fc-daygrid-day-number { color: #d93025 !important; }
    .fc-col-header-cell.fc-day-sat a, .fc-daygrid-day.fc-day-sat .fc-daygrid-day-number { color: #1a73e8 !important; }
    .fc-event { border: none !important; padding: 2px 4px; border-radius: 4px; font-size: 0.85em; font-weight: 500; }
  </style>
</head>
<body>

<div class="header-bar">
    <a href="{% url 'home' %}" class="btn-home">üè† <span>HOME</span></a>
    <h5 class="fw-bold m-0 ms-3">Ï†úÏùºÏïΩÍµ≠ Ï∫òÎ¶∞Îçî</h5>
</div>

<div id="calendar-container">
  <div id="calendar"></div>
</div>

<div class="modal fade" id="applyModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px; border: none;">
      <div class="modal-body p-0">
        <iframe id="applyFrame" src="" style="width:100%; height:450px; border:none; border-radius: 20px;"></iframe>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const applyModal = new bootstrap.Modal(document.getElementById('applyModal'));
    const applyFrame = document.getElementById('applyFrame');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ko',
      headerToolbar: { left: 'today prev,next', center: 'title', right: '' },
      events: "{% url 'calendarapp:event_list' %}",
      eventDidMount: function(info) {
        if (info.event.extendedProps.isHoliday) {
            const dateStr = info.event.startStr;
            const dayEl = document.querySelector(`.fc-daygrid-day[data-date="${dateStr}"]`);
            if (dayEl) { dayEl.classList.add('holiday-red'); }
            info.el.style.display = 'none';
        }
      },
      dateClick: function (info) {
        applyFrame.src = "{% url 'calendarapp:apply' %}?date=" + info.dateStr;
        applyModal.show();
      },
      eventClick: function (info) {
        applyFrame.src = "{% url 'calendarapp:apply' %}?edit=" + info.event.id;
        applyModal.show();
      }
    });

    calendar.render();

    // ÌïµÏã¨: Î©îÏãúÏßÄ ÏàòÏã† Ïãú Ï∫òÎ¶∞ÎçîÎ•º Ï¶âÏãú Î¶¨ÌîÑÎ†àÏãúÌï®
    window.addEventListener("message", function(event) {
        if (event.data === "submitted") {
            applyModal.hide(); 
            // Ï∫òÎ¶∞Îçî Îç∞Ïù¥ÌÑ∞Î•º Îã§Ïãú Í∞ÄÏ†∏Ïò§Í≥† ÌôîÎ©¥ÏùÑ Í∞±Ïã†
            calendar.refetchEvents();
        }
    });

    const harness = document.querySelector('.fc-view-harness');
    if (harness) {
        const mc = new Hammer(harness);
        mc.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
        mc.on("swiperight", () => calendar.prev());
        mc.on("swipeleft", () => calendar.next());
    }
  });
</script>
</body>
</html>