<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const applyFrame = document.getElementById('applyFrame');
    const modalElement = document.getElementById('applyModal');
    const applyModal = new bootstrap.Modal(modalElement);

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ko',
      selectable: true, // 날짜 선택 활성화
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,dayGridWeek'
      },
      events: '/events/',

      dateClick: function (info) {
        // 중복 방지를 위해 src를 먼저 비우고 새로 설정
        applyFrame.src = ""; 
        applyFrame.src = `/apply/?date=${info.dateStr}`;
        applyModal.show();
      },

      eventClick: function (info) {
        applyFrame.src = "";
        applyFrame.src = `/apply/?edit=${info.event.id}`;
        applyModal.show();
      }
    });

    calendar.render();

    window.addEventListener('message', function(e) {
      if (e.data === 'reload') {
        applyModal.hide();
        location.reload(); 
      }
    });
  });
</script>